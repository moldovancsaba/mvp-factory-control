{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mvp-factory-control.local/warroom/incident-bundle.schema.json",
  "title": "WarRoom Incident Evidence Bundle",
  "type": "object",
  "required": [
    "schemaVersion",
    "generatedAt",
    "scope",
    "source",
    "timeline",
    "summary",
    "redaction"
  ],
  "properties": {
    "schemaVersion": { "const": "1.0" },
    "generatedAt": { "type": "string", "format": "date-time" },
    "scope": {
      "type": "object",
      "required": ["project", "sinceHours"],
      "properties": {
        "project": { "type": "string" },
        "issueNumber": { "type": ["integer", "null"] },
        "sinceHours": { "type": "integer", "minimum": 1 }
      }
    },
    "source": {
      "type": "object",
      "required": ["mode", "capturedAt"],
      "properties": {
        "mode": { "enum": ["DATABASE", "FIXTURE"] },
        "capturedAt": { "type": "string", "format": "date-time" }
      }
    },
    "timeline": {
      "type": "object",
      "required": ["lifecycleEvents", "failureEvents"],
      "properties": {
        "lifecycleEvents": { "type": "array" },
        "failureEvents": { "type": "array" }
      }
    },
    "summary": {
      "type": "object",
      "required": ["lifecycleEventCount", "failureEventCount", "taskStatus"],
      "properties": {
        "lifecycleEventCount": { "type": "integer", "minimum": 0 },
        "failureEventCount": { "type": "integer", "minimum": 0 },
        "taskStatus": {
          "type": "object",
          "required": ["total", "done", "failed", "deadLetter", "manualRequired"],
          "properties": {
            "total": { "type": "integer", "minimum": 0 },
            "done": { "type": "integer", "minimum": 0 },
            "failed": { "type": "integer", "minimum": 0 },
            "deadLetter": { "type": "integer", "minimum": 0 },
            "manualRequired": { "type": "integer", "minimum": 0 }
          }
        }
      }
    },
    "redaction": {
      "type": "object",
      "required": ["mode", "matchCount", "ruleIds"],
      "properties": {
        "mode": { "const": "REDACT" },
        "matchCount": { "type": "integer", "minimum": 0 },
        "ruleIds": { "type": "array", "items": { "type": "string" } }
      }
    },
    "boardEvidencePointers": { "type": "object" }
  }
}
