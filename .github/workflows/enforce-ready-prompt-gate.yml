name: Enforce Ready Prompt Gate

on:
  workflow_dispatch:
  schedule:
    - cron: "17 * * * *"

jobs:
  enforce-ready-gate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure scripts executable
        run: chmod +x scripts/mvp-factory-ready-gate-audit.sh scripts/mvp-factory-validate-prompt-package.js

      - name: Enforce gate
        env:
          GH_TOKEN: ${{ secrets.MVP_PROJECT_TOKEN }}
          MVP_PROJECT_OWNER: moldovancsaba
          MVP_PROJECT_NUMBER: "1"
          MVP_REPO: mvp-factory-control
        run: |
          if [ -z "$GH_TOKEN" ]; then
            echo "::warning::MVP_PROJECT_TOKEN not configured. Skipping prompt gate enforcement."
            exit 0
          fi
          ./scripts/mvp-factory-ready-gate-audit.sh --apply --comment
